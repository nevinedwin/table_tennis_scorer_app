AWSTemplateFormatVersion: 2010-09-09
Transform: AWS::Serverless-2016-10-31
Description: "Pipeline Root Template"


Parameters:
  PipelineBucket:
    Type: String
  ProjectName:
    Type: String
  BackendBucket:
    Type: String
    Default: khelapp
  GitHubOwner:
    Type: String
    Default: nevinedwin
  GitHubRepo:
    Type: String
    Default: table_tennis_scorer_app
  GitHubOAuthToken:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /khelApp/CodePipeline/GitHubOAuthToken
  Branch:
    Type: String
    Default: main
    AllowedValues: ['local', 'debug', 'dev', 'main']

Resources:  
  PipelineBackend:
    Type: AWS::Serverless::Application
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Properties:
      Location: pipeline-backend.yaml
      Parameters:
        PipelineBucket: !Ref PipelineBucket
        ProjectName: !Ref ProjectName
        BackendBucket: !Ref BackendBucket
        GitHubOwner: !Ref GitHubOwner
        GitHubRepo: !Ref GitHubRepo
        Branch: !Ref Branch
        GitHubOAuthToken: !Ref GitHubOAuthToken
  
  # PipelineFrontendStack:
  #   Type: AWS::Serverless::Application
  #   UpdateReplacePolicy: Delete
  #   DeletionPolicy: Delete
  #   Properties:
  #     Location: ./pipeline-frontend.yaml
  #     Parameters:
  #       # CodeBuildServiceRoleArn: !GetAtt CodeBuildServiceRole.Arn
    
